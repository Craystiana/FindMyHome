<ion-header>
  <ion-toolbar color="primary">
    <ion-grid class="ion-no-padding">
      <ion-row>
        <ion-col size-lg="2" size-sm="0">
          <ion-title style="height: 100%;">Listings</ion-title>
        </ion-col>
        
        <ion-col offset-lg="2" size-lg="4" size-sm="1">
          <ion-searchbar mode="ios"
                         debounce="500"
                         animated
                         color="dark"
                         placeholder="Search listings"
                         style="padding: inherit;"
                         [(ngModel)]="searchTerm"
                         (ionChange)="getListings()"></ion-searchbar>
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>

    <ion-button slot="end" color="dark" shape="round" title="Add Listing" (click)="addPage()">
      <ion-icon name="add-circle-outline"></ion-icon>
    </ion-button>


  </ion-toolbar>
</ion-header>

<ion-content *ngIf="listings !== undefined">
  <ion-toolbar>
    <ion-select placeholder="Type"
                okText="Save"
                cancelText="Clear"
                slot="start"
                multiple
                class="ion-padding"
                mode="ios"
                name="Listing Type"
                [(ngModel)]="listingType"
                (ionChange)="getListings()">
      <ion-select-option *ngFor="let listingType of listingData.listingTypes" [value]="listingType.id">{{listingType.name}}</ion-select-option>
    </ion-select>

    <ion-select placeholder="County"
                okText="Save"
                cancelText="Clear"
                slot="start"
                multiple
                class="ion-padding"
                mode="ios"
                [(ngModel)]="listingCounty"
                (ionChange)="getListings()">
      <ion-select-option *ngFor="let listingCounty of listingData.listingCounties" [value]="listingCounty.id">{{listingCounty.name}}</ion-select-option>
    </ion-select>

    <ion-select placeholder="City" 
                okText="Save" 
                cancelText="Clear" 
                slot="start" 
                multiple 
                class="ion-padding"
                mode="ios" 
                [(ngModel)]="listingCity" 
                (ionChange)="getListings()">
      <ion-select-option *ngFor="let listingCity of listingData.listingCities" [value]="listingCity.id">{{listingCity.name}}</ion-select-option>
    </ion-select>

    <ion-select placeholder="Sort By"
                okText="Save"
                cancelText="Clear"
                slot="end"
                class="ion-padding"
                mode="ios"
                [(ngModel)]="sortBy" 
                (ionChange)="getListings()">
      <ion-select-option [value]="sortType.Title">Title</ion-select-option>
      <ion-select-option [value]="sortType.Price">Price</ion-select-option>
      <ion-select-option [value]="sortType.CreationDate">Creation Date</ion-select-option>
    </ion-select>
  </ion-toolbar>

  <ion-grid>
    <ion-row style="justify-content: center">
      <ion-col size-lg="3" 
               *ngFor="let listing of listings">
        <ion-card [routerLink]="['/listing/detail']" [queryParams]="{listingId : listing.listingId}">
          <img [src]="listing.picture !== null ?
           'data:image/jpg;base64,' + listing.picture :
           'https://www.zastavki.com/pictures/originals/2020Auto___Honda_Yellow_car_Honda_NSX_on_a_black_background_138992_.jpg'"
          style="width: 100%; height: 200px;"/>
          <ion-card-header class="ion-text-center">
            <ion-card-subtitle>{{listing.listingType}}</ion-card-subtitle>
            <ion-card-title>{{listing.title}}</ion-card-title>
          </ion-card-header>
      
          <ion-card-content>
            <ion-item lines="none" color="transparent">
              <ion-icon name="car-sport-outline" slot="start" color="warning"></ion-icon>
              <ion-label>{{listing.description}}</ion-label>
            </ion-item>
      
            <ion-item lines="none">
              <ion-icon name="cash-outline" slot="start" color="success"></ion-icon> 
              <ion-label>{{listing.price}} RON</ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
     

</ion-content>
